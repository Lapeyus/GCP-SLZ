# GCP Terraform Seed üå±‚òÅÔ∏è

## Overview üìã

This Terraform code is designed to provision the foundational setup for Google Cloud Platform (GCP) projects, services, and service accounts required for Terraform. It also manages the roles and permissions for the Terraform service account.

---

## Seed Project Concept üå±

### What is a Seed Project? ü§î

A seed project is essentially a starting point for your infrastructure. It sets up the basic resources and permissions you need to build out your environments. This includes setting up IAM roles and Federation to run code.

!!! tip "CICD Pipeline"
    The service account created here is used by the CICD pipeline agents through impersonation to create and manage GCP resources.

### Why is it Important? üõ°Ô∏è

The seed project is crucial because it lays the foundation for all your future projects and configurations.

!!! warning "Security Note"
    It ensures that you have a secure, scalable, and maintainable infrastructure by delegating roles to an impersonatable agent.

### Key Components üîë

- **GCP Seed project**
- **Terraform Service Account**
- **IAM Roles at Organization level**
- **IAM Roles at Seed Project level**
- **Workload Identity Federation**

---

### Usage üõ†Ô∏è

1. **Initialization**: An admin user needs to login using the CLI or manually apply the code in this file.
2. **State Migration**: After the initial implementation, the state for the code is stored in a cloud storage bucket.

### Requisites üìù

- A Google Cloud Platform account with sufficient permissions.
- Terraform installed on the local machine.

### Order of Execution üîÑ
``` mermaid
graph TD
  A[Start] --> B[Project Creation]
  B --> C[Activation of APIs]
  C --> D[Service Account Creation]
  D --> E[Roles Assignment]
  E --> F[Workload Identity Federation]
  F --> G[Workload Identity Binding]
  G --> H[End]
```

1. **Project Creation**: Setup a GCP project using the "terraform-google-modules/
2. **Activation of APIs**: Flatten and set the required APIs.
project-factory/google" module.
3. **Service Account Creation**: Define a service account used by Terraform.
4. **Roles Assignment**: Set up the roles for the Terraform service account on the organization and project levels.
5. **Workload Identity Federation**: Setup Workload Identity Federation for GitHub actions.
6. **Workload Identity Binding**: Apply the identity binding.

### Logic üß†

- The `locals` block defines the APIs to be activated.
- The `module "org_seed_project"` sets up the project.
- The `resource "google_service_account"` creates the service account.
- IAM roles are managed through modules `"terraform_sa_organization_iam_bindings"` and `"terraform_sa_project_iam_bindings"`.
- Workload Identity Federation and binding are handled with specific resources.

### Notes üìù

- Make sure to uncomment the key block if needed for initial manual bootstrapping.
- The repository paths and roles can be adjusted as needed.

---
!!! info "Autogenerated Content"
    From this point on, the document is autogenerated. Do not modify it directly.

---

# Code üìú

{% include 'seed.code' %}
