
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../slz-folders-core/">
      
      
      <link rel="icon" href="../img/logo.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.5">
    
    
      
        <title>The Seed Project - Secure Landing Zone in GCP</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gcp-terraform-seed" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Secure Landing Zone in GCP" class="md-header__button md-logo" aria-label="Secure Landing Zone in GCP" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Secure Landing Zone in GCP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Seed Project
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_3">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Lapeyus/GCP-SLZ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Secure Landing Zone in GCP" class="md-nav__button md-logo" aria-label="Secure Landing Zone in GCP" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    Secure Landing Zone in GCP
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Lapeyus/GCP-SLZ" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Secure Landing Zone
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Secure Landing Zone
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    The Seed Project
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    The Seed Project
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gcp-terraform-seed" class="md-nav__link">
    GCP Terraform Seed
  </a>
  
    <nav class="md-nav" aria-label="GCP Terraform Seed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seed-project-concept" class="md-nav__link">
    Seed Project Concept
  </a>
  
    <nav class="md-nav" aria-label="Seed Project Concept">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-seed-project" class="md-nav__link">
    What is a Seed Project?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-is-it-important" class="md-nav__link">
    Why is it Important?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    Key Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requisites" class="md-nav__link">
    Requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-of-execution" class="md-nav__link">
    Order of Execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logic" class="md-nav__link">
    Logic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    Code
  </a>
  
    <nav class="md-nav" aria-label="Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-variables" class="md-nav__link">
    Local Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-org-seed-project" class="md-nav__link">
    Module: Org Seed Project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-service-account" class="md-nav__link">
    Resource: Google Service Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-service-account-key" class="md-nav__link">
    Resource: Google Service Account Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-terraform-service-account-org-iam-bindings" class="md-nav__link">
    Module: Terraform Service Account Org IAM Bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-terraform-service-account-project-iam-bindings" class="md-nav__link">
    Module: Terraform Service Account Project IAM Bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity-pool" class="md-nav__link">
    Identity Pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-iam-workload-identity-pool-provider" class="md-nav__link">
    Resource: Google IAM Workload Identity Pool Provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-service-account-iam-binding" class="md-nav__link">
    Google Service Account IAM Binding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-folders-core/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folders Core
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-groups-iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IAM Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-org-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Organizational Policies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-projects-billing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Billing Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-projects-cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-projects-sharedvpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shared VPC Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-projects-log-monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    L&M
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tfstate-buckets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform State Buckets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../slz-faqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bussiness Unit Configurations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Bussiness Unit Configurations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bu-folders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bu-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bu-projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Projects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bu-faqs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../additional-resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aditional resources
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gcp-terraform-seed" class="md-nav__link">
    GCP Terraform Seed
  </a>
  
    <nav class="md-nav" aria-label="GCP Terraform Seed">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seed-project-concept" class="md-nav__link">
    Seed Project Concept
  </a>
  
    <nav class="md-nav" aria-label="Seed Project Concept">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-seed-project" class="md-nav__link">
    What is a Seed Project?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-is-it-important" class="md-nav__link">
    Why is it Important?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    Key Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requisites" class="md-nav__link">
    Requisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#order-of-execution" class="md-nav__link">
    Order of Execution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logic" class="md-nav__link">
    Logic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code" class="md-nav__link">
    Code
  </a>
  
    <nav class="md-nav" aria-label="Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-variables" class="md-nav__link">
    Local Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-org-seed-project" class="md-nav__link">
    Module: Org Seed Project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-service-account" class="md-nav__link">
    Resource: Google Service Account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-service-account-key" class="md-nav__link">
    Resource: Google Service Account Key
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-terraform-service-account-org-iam-bindings" class="md-nav__link">
    Module: Terraform Service Account Org IAM Bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-terraform-service-account-project-iam-bindings" class="md-nav__link">
    Module: Terraform Service Account Project IAM Bindings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#identity-pool" class="md-nav__link">
    Identity Pool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-google-iam-workload-identity-pool-provider" class="md-nav__link">
    Resource: Google IAM Workload Identity Pool Provider
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-service-account-iam-binding" class="md-nav__link">
    Google Service Account IAM Binding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h2 id="gcp-terraform-seed">GCP Terraform Seed</h2>
<h3 id="overview">Overview</h3>
<p>This Terraform code is designed to provision the foundational setup for Google Cloud Platform (GCP) project, services, and service accounts required for Terraform. It also handles the roles and permissions for the Terraform service account.</p>
<h2 id="seed-project-concept">Seed Project Concept</h2>
<h3 id="what-is-a-seed-project">What is a Seed Project?</h3>
<p>A seed project is essentially a starting point for your infrastructure. It sets up the basic resources and permissions you need to build out your environments. This includes setting up IAM roles and Federation to run code.</p>
<p>The service account created here is used by the CICD pipeline agents through impersonation to create and manage GCP resources.</p>
<h3 id="why-is-it-important">Why is it Important?</h3>
<p>The seed project is crucial because it lays the foundation for all your future projects and configurations. It ensures that you have a secure, scalable, and maintainable infrastructure by delegating this roles to an impersonatable agent.</p>
<h3 id="key-components">Key Components</h3>
<ul>
<li><strong>GCP Seed project</strong></li>
<li><strong>Terraform service Account</strong></li>
<li><strong>IAM Roles at Organization level</strong></li>
<li><strong>IAM Roles at Seed Project level</strong></li>
<li><strong>Workload Identity federation</strong></li>
</ul>
<h3 id="usage">Usage</h3>
<ol>
<li><strong>Initialization</strong>: An admin user needs to login using the CLI or manually apply the code in this file.</li>
<li><strong>State Migration</strong>: After the initial implementation, the state for the code is stored in a cloud storage bucket.</li>
</ol>
<h3 id="requisites">Requisites</h3>
<ul>
<li>A Google Cloud Platform account with sufficient permissions.</li>
<li>Terraform installed in the local machine.</li>
</ul>
<h3 id="order-of-execution">Order of Execution</h3>
<ol>
<li><strong>Activation of APIs</strong>: Flatten and set the required APIs.</li>
<li><strong>Project Creation</strong>: Setup a GCP project using the "terraform-google-modules/project-factory/google" module.</li>
<li><strong>Service Account Creation</strong>: Define a service account used by Terraform.</li>
<li><strong>Roles Assignment</strong>: Set up the roles for the Terraform service account on the organization and project levels.</li>
<li><strong>Workload Identity Federation</strong>: Setup Workload Identity Federation for GitHub actions.</li>
<li><strong>Workload Identity Binding</strong>: Apply the identity binding.</li>
</ol>
<h3 id="logic">Logic</h3>
<ul>
<li>The <code>locals</code> block defines the APIs to be activated.</li>
<li>The <code>module "org_seed_project"</code> sets up the project.</li>
<li>The <code>resource "google_service_account"</code> creates the service account.</li>
<li>IAM roles are managed through modules <code>"terraform_sa_organization_iam_bindings"</code> and <code>"terraform_sa_project_iam_bindings"</code>.</li>
<li>Workload Identity Federation and binding are handled with specific resources.</li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>Make sure to uncomment the key block if needed for initial manual bootstrapping.</li>
<li>The repository paths and roles can be adjusted as needed.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>From this point on the document is autogenerated, don't modify it directly</p>
</div>
<h1 id="code">Code</h1>
<h2 id="local-variables">Local Variables</h2>
<p>The Seed project needs to have all the APIs defined in var.activate_apis enabled
not only for the project itself but for every child project</p>
<ul>
<li>add all APIs</li>
<li>remove duplicates</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">locals</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">  </span><span class="na">activate_apis_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">toset</span><span class="p">(</span><span class="nf">flatten</span><span class="p">(</span><span class="nf">values</span><span class="p">(</span><span class="nv">var.activate_apis</span><span class="p">)))</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="module-org-seed-project">Module: Org Seed Project</h2>
<p>This Terraform module, <code>org_seed_project</code>, is used to create a Google Cloud Project with specific configurations using the Project Factory module, without creating a random project ID, a default service account, or a network, but activating certain APIs.</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;org_seed_project&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="na">source</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-google-modules/project-factory/google&quot;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="na">version</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;14.2.0&quot;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="na">random_project_id</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;false&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="na">default_service_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;delete&quot;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">  </span><span class="na">create_project_sa</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">  </span><span class="na">name</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${var.owner}-seed-prj&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">  </span><span class="na">org_id</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="nv">var.org_id</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">  </span><span class="na">billing_account</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="nv">var.billing_account</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">  </span><span class="na">auto_create_network</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="na">activate_apis</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="nv">local.activate_apis_all</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">  </span><span class="nb">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="na">terraform_managed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="resource-google-service-account">Resource: Google Service Account</h2>
<p>This Terraform code creates a Google Cloud Service Account named <code>Terraform Service Account</code> with the account ID <code>tf_seed_sa</code> in the project created by the <code>org_seed_project</code> module.</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_service_account&quot;</span><span class="w"> </span><span class="nv">&quot;tf_seed_sa&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="na">account_id</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tf_seed_sa&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="na">display_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Terraform Service Account&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="na">project</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">module.org_seed_project.project_id</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="resource-google-service-account-key">Resource: Google Service Account Key</h2>
<p>This Terraform code generates a new private key for the <code>tf_seed_sa</code> Google Cloud Service Account and stores it in <code>google_service_account_key</code> named <code>account_key</code>.</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_service_account_key&quot;</span><span class="w"> </span><span class="nv">&quot;account_key&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="na">service_account_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_service_account.service_account.name</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="module-terraform-service-account-org-iam-bindings">Module: Terraform Service Account Org IAM Bindings</h2>
<ol>
<li>
<p><code>"roles/resourcemanager.organizationAdmin"</code>:
necessary for the service account to manage organization-wide resources effectively.</p>
</li>
<li>
<p><code>"roles/resourcemanager.projectCreator"</code>:
allows the service account to create new projects within the organization.</p>
</li>
<li>
<p><code>"roles/resourcemanager.folderAdmin"</code>:
grants administrative access to manage folders within the organization.</p>
</li>
<li>
<p><code>"roles/compute.xpnAdmin"</code>:
allows the service account to manage network resources across projects.</p>
</li>
<li>
<p><code>"roles/serviceusage.serviceUsageAdmin"</code>:
allows enabling or disabling various Google Cloud services across projects.</p>
</li>
<li>
<p><code>"roles/billing.user"</code>:
allows the service account to view and manage billing information.</p>
</li>
<li>
<p><code>"roles/iam.serviceAccountAdmin"</code>:
grants administrative access to manage service accounts.</p>
</li>
</ol>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;tf_seed_sa_organization_iam_bindings&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span><span class="na">source</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-google-modules/iam/google//modules/organizations_iam&quot;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="na">version</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;7.6.0&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="na">organizations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">var.org_id</span><span class="p">]</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="na">mode</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;additive&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="nb">bindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="s2">&quot;roles/resourcemanager.organizationAdmin&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="s2">&quot;roles/resourcemanager.projectCreator&quot;</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="s2">&quot;roles/resourcemanager.folderAdmin&quot;</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="s2">&quot;roles/compute.xpnAdmin&quot;</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="s2">&quot;roles/serviceusage.serviceUsageAdmin&quot;</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="s2">&quot;roles/billing.user&quot;</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="s2">&quot;roles/iam.serviceAccountAdmin&quot;</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="module-terraform-service-account-project-iam-bindings">Module: Terraform Service Account Project IAM Bindings</h2>
<ol>
<li>
<p><code>"roles/serviceusage.serviceUsageAdmin"</code>: relevant for enabling or disabling specific Google Cloud services within the project.</p>
</li>
<li>
<p><code>"roles/iam.serviceAccountKeyAdmin"</code>: The service account might need to manage its own keys.</p>
</li>
<li>
<p><code>"roles/iam.serviceAccountAdmin"</code>: If the service account needs to manage other service accounts at the project level, is necessary.</p>
</li>
<li>
<p><code>"roles/iam.serviceAccountTokenCreator"</code>: service account needs to create tokens for other service accounts.</p>
</li>
<li>
<p><code>"roles/iam.workloadIdentityUser"</code>: allows the service account to act as a workload identity user.</p>
</li>
<li>
<p><code>"roles/iam.workloadIdentityPoolAdmin"</code>: allows the service account to manage id pools.</p>
</li>
<li>
<p><code>"roles/storage.objectCreator"</code>: Permission to create objects in Cloud Storage.</p>
</li>
<li>
<p><code>"roles/storage.objectViewer"</code>: provides read access to objects in Cloud Storage.</p>
</li>
<li>
<p><code>"roles/storage.admin"</code>: It includes permissions to create, delete, and modify storage buckets and objects.</p>
</li>
</ol>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kr">module</span><span class="w"> </span><span class="nv">&quot;tf_seed_sa_project_iam_bindings&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="na">source</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;terraform-google-modules/iam/google//modules/projects_iam&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="na">version</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;7.6.0&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="na">projects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nv">module.org_seed_project.project_id</span><span class="p">]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="na">mode</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;additive&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="nb">bindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="s2">&quot;roles/serviceusage.serviceUsageAdmin&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="s2">&quot;roles/iam.serviceAccountKeyAdmin&quot;</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="s2">&quot;roles/iam.serviceAccountAdmin&quot;</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="s2">&quot;roles/iam.serviceAccountTokenCreator&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="s2">&quot;roles/iam.workloadIdentityUser&quot;</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="s2">&quot;roles/iam.workloadIdentityPoolAdmin&quot;</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">    </span><span class="s2">&quot;roles/storage.objectCreator&quot;</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">    </span><span class="s2">&quot;roles/storage.objectViewer&quot;</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="s2">&quot;roles/storage.admin&quot;</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;serviceAccount:${google_service_account.tf_seed_sa.email}&quot;</span><span class="p">],</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="identity-pool">Identity Pool</h2>
<p>This Terraform code creates a new Google Cloud IAM Workload Identity Pool with the ID <code>github-terraformer</code> in the specified project, and stores it in <code>google_iam_workload_identity_pool</code> named <code>idp_pool</code>.</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_iam_workload_identity_pool&quot;</span><span class="w"> </span><span class="nv">&quot;idp_pool&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">  </span><span class="na">workload_identity_pool_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-terraformer&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">  </span><span class="na">project</span><span class="w">                   </span><span class="o">=</span><span class="w"> </span><span class="nv">module.org_seed_project.project_id</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="resource-google-iam-workload-identity-pool-provider">Resource: Google IAM Workload Identity Pool Provider</h2>
<p>This Terraform code creates a new Google Cloud IAM Workload Identity Pool Provider for the identity pool <code>github-terraformer</code>, and configures it with an empty list of allowed audiences, an Github issuer URI, and attribute mappings for OIDC (OpenID Connect).</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_iam_workload_identity_pool_provider&quot;</span><span class="w"> </span><span class="nv">&quot;gh_provider&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="na">workload_identity_pool_id</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;github-terraformer&quot;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="na">workload_identity_pool_provider_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gh-actions&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">  </span><span class="na">display_name</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;gh-actions&quot;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">  </span><span class="nb">oidc</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="na">allowed_audiences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="na">issuer_uri</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://token.actions.githubusercontent.com&quot;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">  </span><span class="nb">attribute_mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="s2">&quot;google.subject&quot;</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;assertion.sub&quot;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="s2">&quot;attribute.actor&quot;</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;assertion.actor&quot;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="s2">&quot;attribute.repository&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;assertion.repository&quot;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="google-service-account-iam-binding">Google Service Account IAM Binding</h2>
<p>Member repos can impersonate the terraform SA via github actions.
When possible add one repo at a time, or:</p>
<ul>
<li>Uncomment A to allow all client repos to impersonate the terraform SA</li>
<li>Uncomment B to use Use Workload Identity with Google Kubernetes Engine, once for each namespace</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kr">resource</span><span class="w"> </span><span class="nc">&quot;google_service_account_iam_binding&quot;</span><span class="w"> </span><span class="nv">&quot;workload_identity_binding&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="na">service_account_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">google_service_account.service_account.id</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="na">role</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;roles/iam.workloadIdentityUser&quot;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="na">members</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="s2">&quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository/${var.owner}/${var.owner}-slz&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="s2">&quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository/${var.owner}/${var.owner}-shared-infra&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="s2">&quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository/${var.owner}/${var.owner}-projecta-infra&quot;</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="s2">&quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository/${var.owner}/${var.owner}-projectc-infra&quot;</span><span class="p">,</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="s2">&quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository/${var.owner}/${var.owner}-projectb-infra&quot;</span><span class="p">,</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="c1">    # A: &quot;principalSet://iam.googleapis.com/projects/${module.org_seed_project.project_number}/locations/global/workloadIdentityPools/github-terraformer/attribute.repository_${var.owner}/${var.owner}-Power&quot;,</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1">    # B: &quot;serviceAccount:${module.org_seed_project.project_id}.svc.id.goog[${NAMESPACE}/${var.service_account}]&quot;,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="p">}</span>
</span></code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>